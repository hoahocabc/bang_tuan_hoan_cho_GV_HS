<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- For proper display on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bảng tuần hoàn NTHH (hoahocABC)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <style>
      /* ------------------------
         GENERAL SETTINGS
      ------------------------- */
      body {
        margin: 0;
        background: #ffffff;
      }
      #defaultCanvas0 {
        display: block;
        margin: auto;
      }
  
      /* ------------------------
         TOOLBAR STYLE
      ------------------------- */
      .toolbar {
        position: fixed;
        top: 10px;
        left: 10px;
        padding: 7px 12px;
        background: #fff;
        border-radius: 6px;
        box-shadow: 0 2px 10px #0001;
        z-index: 1000;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
      }
      .toolbar label {
        margin-right: 15px;
        user-select: none;
        margin-bottom: 0;
        display: inline-flex;
        align-items: center;
      }
      .toolbar input[type="checkbox"] {
        vertical-align: middle;
      }
      .toolbar button {
        margin-left: 18px;
        padding: 4px 14px;
        font-size: 0.9em;
        border-radius: 7px;
        border: 1px solid #ddd;
        background: #fff;
        cursor: pointer;
      }
  
      /* ------------------------
         LANGUAGE SELECTION STYLE
      ------------------------- */
      .language-wrapper {
        position: fixed;
        top: 10px;
        right: 10px;
        background: #fff;
        padding: 7px 12px;
        border-radius: 6px;
        box-shadow: 0 2px 10px #0001;
        z-index: 1000;
        font-size: 1em;
        display: inline-flex;
        align-items: center;
      }
      .language-wrapper label {
        margin-right: 8px;
        user-select: none;
        font-size: 0.9em;
      }
      .language-wrapper select {
        padding: 4px 14px;
        font-size: 0.9em;
        border-radius: 7px;
        border: 1px solid #ddd;
        cursor: pointer;
      }
  
      /* ------------------------
         POPUP STYLES (Element Info & Instructions)
      ------------------------- */
      #element-popup {
        position: fixed;
        z-index: 10000;
        pointer-events: auto;
        display: none;
        background: #fff;
        border: 1px solid #ccc;
        border-radius: 12px;
        box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.15);
        padding: 10px 15px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: #111;
        min-width: 220px;
        max-width: 360px;
        font-size: 1.2rem;
        text-align: left;
        transition: left 0.3s ease, top 0.3s ease, transform 0.3s ease;
        cursor: pointer;
      }
      #element-popup .popup-title {
        font-size: 1.8rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
        color: #000;
        text-align: center;
      }
      /* Ensure each line of info remains in one row */
      #element-popup div:not(.popup-title) {
        font-size: 1.2rem;
        font-weight: normal;
        color: #111;
        margin-bottom: 0.5rem;
      }
      #element-popup.dragging {
        cursor: default;
      }
  
      /* Updated Note Popup Styles */
      #note-popup {
        position: fixed;
        z-index: 10001;
        pointer-events: auto;
        display: none;
        background: #fff;
        border: 1px solid #ccc;
        border-radius: 10px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.2);
        padding: 24px 34px 22px 34px;
        font-family: Arial, sans-serif;
        color: #222;
        max-width: 253px;
        min-width: 220px;
        font-size: 1.2rem;
        left: 20px;
        top: 80px;
        transition: left 0.3s ease, top 0.3s ease, transform 0.3s ease;
        text-align: left;
        max-height: 400px;
        overflow-y: auto;
        cursor: pointer;
      }
      #note-popup.dragging {
        cursor: default;
        user-select: none;
      }
      #note-popup .note-title {
        font-weight: bold;
        font-size: 1.5em;
        margin-bottom: 0.6em;
        color: #2547a1;
        text-align: center;
        cursor: pointer;
      }
      #note-popup .note-close {
        position: absolute;
        top: 8px;
        right: 17px;
        font-size: 1.4em;
        color: #888;
        cursor: pointer;
        font-weight: bold;
        background: none;
        border: none;
      }
      #note-popup ul {
        margin: 0.3em 0 0.5em 1.3em;
        padding: 0 0 0 0.4em;
      }
      #note-popup code {
        background: #f6f6f8;
        padding: 0.1em 0.4em;
        border-radius: 4px;
        font-size: 0.97em;
      }
  
      /* ------------------------
         MOBILE STYLES
      ------------------------- */
      @media screen and (max-width: 600px) {
        .toolbar {
          padding: 4px 8px;
          font-size: 0.9em;
        }
        .toolbar label {
          margin-right: 8px;
        }
        .toolbar button {
          margin-left: 8px;
          padding: 3px 10px;
          font-size: 0.9em;
        }
        .language-wrapper {
          padding: 4px 8px;
          font-size: 0.9em;
          top: 5px;
          right: 5px;
        }
      }
      /* Additional mobile portrait adjustments */
      @media screen and (max-width: 600px) and (orientation: portrait) {
        /* Add extra padding on the sides so that the first and last columns are not flush with the screen edge */
        body {
          padding-left: 10px;
          padding-right: 10px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Toolbar (excluding language selection) -->
    <div class="toolbar" id="toolbar">
      <label>
        <input type="checkbox" id="showMetal" />
        <span id="label_showMetal">Kim loại</span>
      </label>
      <label>
        <input type="checkbox" id="showNonMetal" />
        <span id="label_showNonMetal">Phi kim</span>
      </label>
      <label>
        <input type="checkbox" id="showNobleGas" />
        <span id="label_showNobleGas">Khí trơ (khí hiếm)</span>
      </label>
      <label>
        <input type="checkbox" id="showPrecious" />
        <span id="label_showPrecious">Á kim</span>
      </label>
      <!-- Checkbox for blocks -->
      <label>
        <input type="checkbox" id="showS" />
        <span id="label_showS">Khối s</span>
      </label>
      <label>
        <input type="checkbox" id="showP" />
        <span id="label_showP">Khối p</span>
      </label>
      <label>
        <input type="checkbox" id="showD" />
        <span id="label_showD">Khối d</span>
      </label>
      <label>
        <input type="checkbox" id="showF" />
        <span id="label_showF">Khối f</span>
      </label>
      <label>
        <input type="checkbox" id="showConfig" checked />
        <span id="label_showConfig">Cấu hình e</span>
      </label>
      <button id="note-btn">
        <span id="label_guide">Hướng dẫn</span>
      </button>
    </div>
  
    <!-- Language selection placed in a fixed div at the top right -->
    <div class="language-wrapper" id="language-wrapper">
      <label id="languageLabel">Language:</label>
      <select id="languageSelect">
        <option value="vi">Tiếng Việt</option>
        <option value="en">English</option>
        <option value="zh">中文</option>
        <option value="hi">हिन्दी</option>
        <option value="es">Español</option>
        <option value="fr">Français</option>
        <option value="ru">Русский</option>
        <option value="ar">العربية</option>
      </select>
    </div>
  
    <!-- Element information popup (manual toggle persists) -->
    <div id="element-popup"></div>
  
    <!-- Updated Usage Instructions Popup -->
    <div id="note-popup">
      <button class="note-close" onclick="closeNotePopup(event)">&times;</button>
      <div class="note-title" id="noteTitle">Hướng dẫn</div>
      <ul id="noteList"></ul>
    </div>
  
    <script>
      // Translation dictionary for interface texts.
      const translations = {
        vi: {
          showMetal: "Kim loại",
          showNonMetal: "Phi kim",
          showNobleGas: "Khí trơ (khí hiếm)",
          showPrecious: "Á kim",
          showS: "Khối s",
          showP: "Khối p",
          showD: "Khối d",
          showF: "Khối f",
          showConfig: "Cấu hình e",
          languageLabel: "Language",
          guide: "Hướng dẫn",
          noteTitle: "Hướng dẫn",
          noteList: [
            "<li><b>Bấm chuột trái vào ô nguyên tố</b> để bật cửa sổ nổi (popup) xem thông tin cơ bản.</li>",
            "<li><b>Tắt popup</b> bằng cách bấm lại ô nguyên tố, bấm vào popup hoặc vùng trống.</li>",
            "<li><b>Bấm chuột trái vào số thứ tự hàng (chu kỳ)</b> để bật/tắt tô sáng toàn bộ hàng.</li>",
            "<li><b>Bấm chuột trái vào số thứ tự cột (nhóm)</b> để bật/tắt tô sáng toàn bộ cột.</li>",
            "<li><b>Bấm giữ phím Ctrl (Windows) hoặc Command (Mac) và bấm chuột trái</b> để di chuyển bảng tuần hoàn.</li>",
            "<li><b>Dùng con lăn chuột</b> để phóng to/thu nhỏ bảng.</li>",
            "<li><b>Click đúp</b> vào bất kỳ vị trí nào để đặt lại bảng về trạng thái ban đầu.</li>",
            "<li><b>Bấm chuột trái vào các nút kiểm trên thanh công cụ</b> để bật/tắt nhóm nguyên tố và cấu hình electron.</li>",
            "<li><b>Các dấu <code>✬</code> và <code>✬✬</code></b> chỉ vị trí của dãy Lanthanide và Actinide.</li>",
            "<li><b>Với á kim:</b> chỉ liệt kê 6 nguyên tố được chấp nhận.</li>",
            "<li><b>Với La và Ac:</b> Mặc dù không “chuẩn lý thuyết cấu hình e⁻”, nhưng trong giảng dạy phổ thông và phần lớn bảng tuần hoàn hiện hành, La và Ac vẫn được xem là các nguyên tố thuộc khối f.</li>",
            "<li><i><b>Hóa học ABC</b> hy vọng bảng tuần hoàn này hữu dụng cho thầy cô và học sinh.</i></li>"
          ],
          atomicNumber: "Số hiệu nguyên tử",
          atomicMass: "Nguyên tử khối",
          covalentRadius: "Bán kính cộng hóa trị",
          electronegativity: "Độ âm điện (Pauling)",
          electronConfig: "Cấu hình e",
          legendS: "Nguyên tố s",
          legendP: "Nguyên tố p",
          legendD: "Nguyên tố d",
          legendF: "Nguyên tố f"
        },
        en: {
          showMetal: "Metal",
          showNonMetal: "Non-metal",
          showNobleGas: "Noble Gas",
          showPrecious: "Precious",
          showS: "s-block",
          showP: "p-block",
          showD: "d-block",
          showF: "f-block",
          showConfig: "Electron Config",
          languageLabel: "Language",
          guide: "Guide",
          noteTitle: "Guide",
          noteList: [
            "<li><b>Left-click on an element</b> to open a popup displaying basic details.</li>",
            "<li><b>Close the popup</b> by clicking the same element, the popup, or an empty area.</li>",
            "<li><b>Click on the period number</b> to toggle highlighting of the entire row.</li>",
            "<li><b>Click on the group number</b> to toggle highlighting of the entire column.</li>",
            "<li><b>Hold Ctrl (Windows) or Command (Mac) and left-click</b> to move the periodic table.</li>",
            "<li><b>Use the mouse wheel</b> to zoom in/out of the table.</li>",
            "<li><b>Double-click</b> anywhere to reset the table to its initial state.</li>",
            "<li><b>Click on the check buttons in the toolbar</b> to toggle the display of element groups and electron configurations.</li>",
            "<li><b>The symbols <code>✬</code> and <code>✬✬</code></b> indicate the positions of the Lanthanide and Actinide series.</li>",
            "<li><b>For Precious Metals:</b> only 6 accepted elements are shown.</li>",
            "<li><b>For La and Ac:</b> Although they do not follow the ‘theoretical standard electron configuration’, in common teaching and in most current periodic tables, La and Ac are considered as f‑block elements.</li>",
            "<li><i><b>Hóa học ABC</b> hopes this periodic table is useful for teachers and students.</i></li>"
          ],
          atomicNumber: "Atomic Number",
          atomicMass: "Atomic Mass",
          covalentRadius: "Covalent Radius",
          electronegativity: "Electronegativity (Pauling)",
          electronConfig: "Electron Config",
          legendS: "s-block element",
          legendP: "p-block element",
          legendD: "d-block element",
          legendF: "f-block element"
        },
        zh: {
          showMetal: "金属",
          showNonMetal: "非金属",
          showNobleGas: "惰性气体",
          showPrecious: "贵金属",
          showS: "s区",
          showP: "p区",
          showD: "d区",
          showF: "f区",
          showConfig: "电子构型",
          languageLabel: "语言",
          guide: "指南",
          noteTitle: "指南",
          noteList: [
            "<li><b>左键点击一个元素</b>以显示基本信息。</li>",
            "<li><b>点击元素或空白处</b>关闭弹出窗口。</li>",
            "<li><b>点击周期号</b>切换整行高亮。</li>",
            "<li><b>点击族号</b>切换整列高亮。</li>",
            "<li><b>按住Ctrl（Windows）或Command（Mac）并点击左键</b>移动表格。</li>",
            "<li><b>使用鼠标滚轮</b>缩放表格。</li>",
            "<li><b>双击</b>任意位置重置表格。</li>",
            "<li><b>点击工具栏上的复选按钮</b>切换元素组和电子构型显示。</li>",
            "<li><b>符号 <code>✬</code> 和 <code>✬✬</code></b>表示镧系和锕系的位置。</li>",
            "<li><b>贵金属:</b> 仅显示6个被认可的元素。</li>",
            "<li><b>对于La和Ac：</b>尽管它们不符合“标准电子构型”的理论要求，但在普通教学和大多数现行周期表中，La和Ac仍被视为f区元素。</li>",
            "<li><i><b>Hóa học ABC</b> 希望此周期表对教师和学生有帮助。</i></li>"
          ],
          atomicNumber: "原子序数",
          atomicMass: "原子质量",
          covalentRadius: "共价半径",
          electronegativity: "电负性 (Pauling)",
          electronConfig: "电子配置",
          legendS: "s区元素",
          legendP: "p区元素",
          legendD: "d区元素",
          legendF: "f区元素"
        },
        hi: {
          showMetal: "धातु",
          showNonMetal: "अधातु",
          showNobleGas: "अनारक्षित गैस",
          showPrecious: "कीमती धाता",
          showS: "s-ब्लॉक",
          showP: "p-ब्लॉक",
          showD: "d-ब्लॉक",
          showF: "f-ब्लॉक",
          showConfig: "इलेक्ट्रॉन विन्यास",
          languageLabel: "भाषा",
          guide: "गाइड",
          noteTitle: "गाइड",
          noteList: [
            "<li><b>एक तत्व पर क्लिक करें</b> ताकि बुनियादी जानकारी दिखे।</li>",
            "<li><b>वही तत्व या खाली जगह पर क्लिक करें</b> ताकि पॉपअप बंद हो जाए।</li>",
            "<li><b>पिरियड नंबर पर क्लिक करें</b> ताकि पूरी पंक्ति हाइलाइट हो जाए।</li>",
            "<li><b>ग्रुप नंबर पर क्लिक करें</b> ताकि पूरी कॉलम हाइलाइट हो जाए।</li>",
            "<li><b>Ctrl (Windows) या Command (Mac) दबाते हुए क्लिक करें</b> ताकि तालिका को घुमाया जा सके।</li>",
            "<li><b>माउस व्हील का उपयोग करें</b> ताकि तालिका का आकार बदले।</li>",
            "<li><b>डबल-क्लिक करें</b> कहीं भी ताकि तालिका रीसेट हो जाए।</li>",
            "<li><b>टूलबार के चेकबॉक्स पर क्लिक करें</b> ताकि तत्व समूह और इलेक्ट्रॉन विन्यास दिखे।</li>",
            "<li><b>संकेत <code>✬</code> और <code>✬✬</code></b> लैन्थेनाइड और एक्टिनाइड के स्थान को दर्शाते हैं।</li>",
            "<li><b>कीमती धातु:</b> केवल 6 तत्व दिखाए जाते हैं।</li>",
            "<li><b>La और Ac के लिए:</b> भले ही ये ‘मानक इलेक्ट्रॉन विन्यास’ सिद्धांत पर खरा नहीं होते, पर सामान्य शिक्षण और अधिकांश प्रचलित आवर्त सारिणी में, La और Ac को f-ब्लॉक तत्वों के रूप में माना जाता है।</li>",
            "<li><i><b>Hóa học ABC</b> आशा करता है कि यह चक्र सारिणी शिक्षकों और छात्रों के लिए उपयोगी होगी।</i></li>"
          ],
          atomicNumber: "परमाणु क्रमांक",
          atomicMass: "परमाणु द्रव्यमान",
          covalentRadius: "सांद्रता त्रिज्या",
          electronegativity: "विद्युतऋणात्मकता (Pauling)",
          electronConfig: "इलेक्ट्रॉन विन्यास",
          legendS: "s-ब्लॉक तत्व",
          legendP: "p-ब्लॉक तत्व",
          legendD: "d-ब्लॉक तत्व",
          legendF: "f-ब्लॉक तत्व"
        },
        es: {
          showMetal: "Metales",
          showNonMetal: "No metales",
          showNobleGas: "Gases nobles",
          showPrecious: "Metales preciosos",
          showS: "Bloque s",
          showP: "Bloque p",
          showD: "Bloque d",
          showF: "Bloque f",
          showConfig: "Configuración de electrones",
          languageLabel: "Idioma",
          guide: "Guía",
          noteTitle: "Guía",
          noteList: [
            "<li><b>Clic izquierdo en un elemento</b> para abrir un popup con información básica.</li>",
            "<li><b>Cierra el popup</b> haciendo clic en el mismo elemento, en el popup o en un área vacía.</li>",
            "<li><b>Clic en el número de período</b> para resaltar toda la fila.</li>",
            "<li><b>Clic en el número de grupo</b> para resaltar toda la columna.</li>",
            "<li><b>Mantén presionado Ctrl (Windows) o Command (Mac) y clic izquierdo</b> para mover la tabla periódica.</li>",
            "<li><b>Usa la rueda del ratón</b> para hacer zoom in/out en la tabla.</li>",
            "<li><b>Doble clic</b> en cualquier parte para restablecer la tabla a su estado inicial.</li>",
            "<li><b>Clic en los botones de la barra de herramientas</b> para alternar la visualización de grupos de elementos y configuraciones electrónicas.</li>",
            "<li><b>Los símbolos <code>✬</code> y <code>✬✬</code></b> indican la posición de las series de lantánidos y actínidos.</li>",
            "<li><b>Para metales preciosos:</b> solo se muestran 6 elementos aceptados.</li>",
            "<li><b>Para La y Ac:</b> Aunque no tienen la 'configuración electrónica estándar' teórica, en la enseñanza habitual y en la mayoría de las tablas periódicas actuales, La y Ac se consideran elementos del bloque f.</li>",
            "<li><i><b>Hóa học ABC</b> espera que esta tabla periódica sea útil para profesores y estudiantes.</i></li>"
          ],
          atomicNumber: "Número atómico",
          atomicMass: "Masa atómica",
          covalentRadius: "Radio covalente",
          electronegativity: "Electronegatividad (Pauling)",
          electronConfig: "Configuración electrónica",
          legendS: "Elemento de bloque s",
          legendP: "Elemento de bloque p",
          legendD: "Elemento de bloque d",
          legendF: "Elemento de bloque f"
        },
        fr: {
          showMetal: "Métaux",
          showNonMetal: "Non-métaux",
          showNobleGas: "Gaz nobles",
          showPrecious: "Métaux précieux",
          showS: "Bloc s",
          showP: "Bloc p",
          showD: "Bloc d",
          showF: "Bloc f",
          showConfig: "Configuration électronique",
          languageLabel: "Langue",
          guide: "Guide",
          noteTitle: "Guide",
          noteList: [
            "<li><b>Cliquez gauche sur un élément</b> pour afficher les informations de base dans une fenêtre popup.</li>",
            "<li><b>Fermez la popup</b> en cliquant de nouveau sur l’élément, sur la popup ou sur une zone vide.</li>",
            "<li><b>Cliquez sur le numéro de période</b> pour surligner toute la ligne.</li>",
            "<li><b>Cliquez sur le numéro de groupe</b> pour surligner toute la colonne.</li>",
            "<li><b>Maintenez Ctrl (Windows) ou Command (Mac) et cliquez</b> pour déplacer le tableau périodique.</li>",
            "<li><b>Utilisez la molette de la souris</b> pour zoomer/dézoomer le tableau.</li>",
            "<li><b>Double-cliquez</b> n’importe où pour réinitialiser le tableau.</li>",
            "<li><b>Cliquez sur les boutons de la barre d’outils</b> pour activer/désactiver l’affichage des groupes d’éléments et de leur configuration électronique.</li>",
            "<li><b>Les symboles <code>✬</code> et <code>✬✬</code></b> indiquent la position des séries des lanthanides et actinides.</li>",
            "<li><b>Pour les métaux précieux :</b> seuls 6 éléments reconnus sont affichés.</li>",
            "<li><b>Pour La et Ac :</b> Bien qu’ils ne respectent pas la « configuration électronique théorique standard », dans l’enseignement courant et dans la majorité des tableaux périodiques actuels, La et Ac sont considérés comme appartenant au bloc f.</li>",
            "<li><i><b>Hóa học ABC</b> espère que ce tableau périodique sera utile aux enseignants et aux étudiants.</i></li>"
          ],
          atomicNumber: "Numéro atomique",
          atomicMass: "Masse atomique",
          covalentRadius: "Rayon covalent",
          electronegativity: "Électronégativité (Pauling)",
          electronConfig: "Configuration électronique",
          legendS: "Élément du bloc s",
          legendP: "Élément du bloc p",
          legendD: "Élément du bloc d",
          legendF: "Élément du bloc f"
        },
        ru: {
          showMetal: "Металлы",
          showNonMetal: "Неметаллы",
          showNobleGas: "Благородные газы",
          showPrecious: "Драгоценные металлы",
          showS: "s-блок",
          showP: "p-блок",
          showD: "d-блок",
          showF: "f-блок",
          showConfig: "Электронная конфигурация",
          languageLabel: "Язык",
          guide: "Руководство",
          noteTitle: "Руководство",
          noteList: [
            "<li><b>Щелкните левой кнопкой мыши по элементу</b>, чтобы открыть всплывающее окно с основной информацией.</li>",
            "<li><b>Закройте всплывающее окно</b>, щелкнув по тому же элементу, по самому окну или по пустой области.</li>",
            "<li><b>Нажмите на номер периода</b>, чтобы выделить всю строку.</li>",
            "<li><b>Нажмите на номер группы</b>, чтобы выделить весь столбец.</li>",
            "<li><b>Удерживайте Ctrl (Windows) или Command (Mac) и щелкайте</b> для перемещения таблицы.</li>",
            "<li><b>Используйте колесико мыши</b> для масштабирования таблицы.</li>",
            "<li><b>Дважды щелкните</b> в любом месте, чтобы сбросить таблицу.</li>",
            "<li><b>Щелкните по чекбоксам на панели инструментов</b> для переключения отображения групп элементов и электронной конфигурации.</li>",
            "<li><b>Символы <code>✬</code> и <code>✬✬</code></b> указывают на положение лантаноидов и актиноидов.</li>",
            "<li><b>Для драгоценных металлов:</b> показываются только 6 элементов.</li>",
            "<li><b>Для La и Ac:</b> Хотя они не соответствуют «теоретически стандартной электронной конфигурации», в обычном обучении и в большинстве современных периодических таблиц La и Ac считаются элементами f-блока.</li>",
            "<li><i><b>Hóa học ABC</b> надеется, что эта периодическая таблица будет полезна преподавателям и студентам.</i></li>"
          ],
          atomicNumber: "Атомный номер",
          atomicMass: "Атомная масса",
          covalentRadius: "Ковалентный радиус",
          electronegativity: "Электроотрицательность (Паулинг)",
          electronConfig: "Электронная конфигурация",
          legendS: "Элемент s-блока",
          legendP: "Элемент p-блока",
          legendD: "Элемент d-блока",
          legendF: "Элемент f-блока"
        },
        ar: {
          showMetal: "المعادن",
          showNonMetal: "غير المعادن",
          showNobleGas: "الغازات النبيلة",
          showPrecious: "المعادن النفيسة",
          showS: "الكتلة s",
          showP: "الكتلة p",
          showD: "الكتلة d",
          showF: "الكتلة f",
          showConfig: "تكوين الإلكترونات",
          languageLabel: "اللغة",
          guide: "الدليل",
          noteTitle: "الدليل",
          noteList: [
            "<li><b>انقر بزر الماوس الأيسر على عنصر</b> لعرض المعلومات الأساسية في نافذة منبثقة.</li>",
            "<li><b>أغلق النافذة المنبثقة</b> بالنقر على نفس العنصر أو النافذة أو في منطقة فارغة.</li>",
            "<li><b>انقر على رقم الفترة</b> لتحديد الصف بأكمله.</li>",
            "<li><b>انقر على رقم المجموعة</b> لتحديد العمود بأكمله.</li>",
            "<li><b>اضغط مع الاستمرار على Ctrl (Windows) أو Command (Mac) وانقر</b> لتحريك الجدول.</li>",
            "<li><b>استخدم عجلة الفأرة</b> للتكبير أو التصغير.</li>",
            "<li><b>انقر نقرًا مزدوجًا</b> في أي مكان لإعادة تعيين الجدول.</li>",
            "<li><b>انقر على مربعات الاختيار في شريط الأدوات</b> لتبديل عرض مجموعات العناصر وتكوين الإلكترونات.</li>",
            "<li><b>الرموز <code>✬</code> و <code>✬✬</code></b> تشير إلى مواقع سلسلتي اللانثانيدات والأكتينيدات.</li>",
            "<li><b>بالنسبة للمعادن النفيسة:</b> يتم عرض 6 عناصر فقط.</li>",
            "<li><b>بالنسبة لـ La وAc:</b> على الرغم من أنهما لا يتبعان 'التكوين الإلكتروني القياسي النظري'، إلا أنهما يُعتبران من العناصر في كتلة f في التدريس الشائع ومعظم الجداول الدورية المعمول بها.</li>",
            "<li><i><b>Hóa học ABC</b> يأمل أن تكون هذه الجدول الدوري مفيدة للمعلمين والطلاب.</i></li>"
          ],
          atomicNumber: "الرقم الذري",
          atomicMass: "الكتلة الذرية",
          covalentRadius: "نصف قطر التساهم",
          electronegativity: "الكهربية (باولينج)",
          electronConfig: "تكوين الإلكترونات"
        }
      };
  
      let currentLang = "vi";
      let manualToggle = false;
      let hoveredIndex = null;
      // DOM elements for popups
      let infoPopup = document.getElementById("element-popup");
      let notePopup = document.getElementById("note-popup");
      let selected = null;
  
      function updateLanguage() {
        let selectedLang = document.getElementById("languageSelect").value;
        if (!translations[selectedLang]) { selectedLang = "en"; }
        currentLang = selectedLang;
        document.getElementById("label_showMetal").textContent = translations[currentLang].showMetal;
        document.getElementById("label_showNonMetal").textContent = translations[currentLang].showNonMetal;
        document.getElementById("label_showNobleGas").textContent = translations[currentLang].showNobleGas;
        document.getElementById("label_showPrecious").textContent = translations[currentLang].showPrecious;
        document.getElementById("label_showS").textContent = translations[currentLang].showS;
        document.getElementById("label_showP").textContent = translations[currentLang].showP;
        document.getElementById("label_showD").textContent = translations[currentLang].showD;
        document.getElementById("label_showF").textContent = translations[currentLang].showF;
        document.getElementById("label_showConfig").textContent = translations[currentLang].showConfig;
        document.getElementById("languageLabel").textContent = translations[currentLang].languageLabel + ":";
        document.getElementById("label_guide").textContent = translations[currentLang].guide;
        document.getElementById("noteTitle").textContent = translations[currentLang].noteTitle;
  
        // Update guide list
        const noteList = document.getElementById("noteList");
        noteList.innerHTML = "";
        translations[currentLang].noteList.forEach(item => {
          const li = document.createElement("li");
          li.innerHTML = item.replace(/^<li>|<\/li>$/g, "");
          noteList.appendChild(li);
        });
  
        // Adjust font sizes for French and Russian
        if(currentLang === "fr" || currentLang === "ru") {
          // Reduce toolbar label font size
          document.querySelectorAll(".toolbar span").forEach(el => {
            el.style.fontSize = "0.8em";
          });
          // Further reduce the popup font size a bit more for French and Russian
          infoPopup.style.fontSize = "0.9rem";
          // Set each child div (except popup title) to no wrapping
          Array.from(infoPopup.children).forEach(child => {
            if(!child.classList.contains("popup-title")){
              child.style.whiteSpace = "nowrap";
            }
          });
        } else {
          // Reset to defaults for other languages
          document.querySelectorAll(".toolbar span").forEach(el => {
            el.style.fontSize = "";
          });
          infoPopup.style.fontSize = "1.2rem";
          Array.from(infoPopup.children).forEach(child => {
            child.style.whiteSpace = "";
          });
        }
  
        // If an element info popup is currently open, update its content
        if (infoPopup && infoPopup.style.display !== "none" && selected !== null) {
          showInfoPopup(selected);
        }
        redraw();
      }
  
      document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("languageSelect").addEventListener("change", updateLanguage);
        updateLanguage();
      });
  
      // Utility Functions for Electron Configuration Formatting
      function toSuperscript(numStr) {
        return numStr.replace(/\d/g, d => "⁰¹²³⁴⁵⁶⁷⁸⁹"[d]);
      }
      function formatElectronConfig(config) {
        return config.replace(/(\d)([spdf])(\d+)/g, (m, n, l, e) => n + l + toSuperscript(e));
      }
  
      // ELEMENT CATEGORIES
      const nonMetals = new Set(["H", "C", "N", "O", "F", "P", "S", "Cl", "Se", "Br", "I"]);
      const nobleGases = new Set(["He", "Ne", "Ar", "Kr", "Xe", "Rn", "Og"]);
      const metalloids = new Set(["B", "Si", "Ge", "As", "Sb", "Te"]);
      function isNonMetal(sym) { return nonMetals.has(sym); }
      function isMetal(sym) { return !nonMetals.has(sym) && !nobleGases.has(sym) && !metalloids.has(sym); }
  
      // CONSTANTS for layout and colors
      const STAR_COL_IDX = 2, fBlockYOffset = 40;
      const blockColors = { s: "#9cf", p: "#f99", d: "#ff7", f: "#7e9", null: "#eee" };
      const blockHighlight = { s: "#6ed6ff", p: "#ffabb3", d: "#ffffb5", f: "#b0f5a6", null: "#fff" };
      const groupBLabels = {
        3: "IIIB", 4: "IVB", 5: "VB", 6: "VIB", 7: "VIIB",
        8: "VIIIB", 9: "VIIIB", 10: "VIIIB", 11: "IB", 12: "IIB"
      };
  
      // DATA: Full Periodic Table (118 Elements)
      // Structure: [Atomic Number, Symbol, Name, Atomic Mass, Electron Config, Covalent Radius (pm), Electronegativity, Group, Period, Block, Group Label]
      const elements = [
        [1, "H", "Hydrogen", 1.008, "1s1", 37, 2.20, 1, 1, "s", "IA"],
        [2, "He", "Helium", 4.002602, "1s2", 31, 0, 18, 1, "s", "VIIA"],
        [3, "Li", "Lithium", 6.94, "[He]2s1", 134, 0.98, 1, 2, "s", "IA"],
        [4, "Be", "Beryllium", 9.0121831, "[He]2s2", 105, 1.57, 2, 2, "s", "IIA"],
        [5, "B", "Boron", 10.81, "[He]2s2 2p1", 85, 2.04, 13, 2, "p", "IIIA"],
        [6, "C", "Carbon", 12.011, "[He]2s2 2p2", 75, 2.55, 14, 2, "p", "IVA"],
        [7, "N", "Nitrogen", 14.007, "[He]2s2 2p3", 70, 3.04, 15, 2, "p", "VA"],
        [8, "O", "Oxygen", 15.999, "[He]2s2 2p4", 66, 3.44, 16, 2, "p", "VIA"],
        [9, "F", "Fluorine", 18.998403163, "[He]2s2 2p5", 57, 3.98, 17, 2, "p", "VIIA"],
        [10, "Ne", "Neon", 20.1797, "[He]2s2 2p6", 58, 0, 18, 2, "p", "VIIA"],
        [11, "Na", "Sodium", 22.98976928, "[Ne]3s1", 154, 0.93, 1, 3, "s", "IA"],
        [12, "Mg", "Magnesium", 24.305, "[Ne]3s2", 130, 1.31, 2, 3, "s", "IIA"],
        [13, "Al", "Aluminium", 26.9815385, "[Ne]3s2 3p1", 118, 1.61, 13, 3, "p", "IIIA"],
        [14, "Si", "Silicon", 28.085, "[Ne]3s2 3p2", 111, 1.90, 14, 3, "p", "IVA"],
        [15, "P", "Phosphorus", 30.973761998, "[Ne]3s2 3p3", 107, 2.19, 15, 3, "p", "VA"],
        [16, "S", "Sulfur", 32.06, "[Ne]3s2 3p4", 105, 2.58, 16, 3, "p", "VIA"],
        [17, "Cl", "Chlorine", 35.45, "[Ne]3s2 3p5", 102, 3.16, 17, 3, "p", "VIIA"],
        [18, "Ar", "Argon", 39.948, "[Ne]3s2 3p6", 106, 0, 18, 3, "p", "VIIA"],
        [19, "K", "Potassium", 39.0983, "[Ar]4s1", 196, 0.82, 1, 4, "s", "IA"],
        [20, "Ca", "Calcium", 40.078, "[Ar]4s2", 174, 1.00, 2, 4, "s", "IIA"],
        [21, "Sc", "Scandium", 44.955908, "[Ar]3d1 4s2", 144, 1.36, 3, 4, "d", "IIIB"],
        [22, "Ti", "Titanium", 47.867, "[Ar]3d2 4s2", 136, 1.54, 4, 4, "d", "IVB"],
        [23, "V", "Vanadium", 50.9415, "[Ar]3d3 4s2", 131, 1.63, 5, 4, "d", "VB"],
        [24, "Cr", "Chromium", 51.9961, "[Ar]3d5 4s1", 128, 1.66, 6, 4, "d", "VIB"],
        [25, "Mn", "Manganese", 54.938044, "[Ar]3d5 4s2", 127, 1.55, 7, 4, "d", "VIIB"],
        [26, "Fe", "Iron", 55.845, "[Ar]3d6 4s2", 126, 1.83, 8, 4, "d", "VIIIB"],
        [27, "Co", "Cobalt", 58.933194, "[Ar]3d7 4s2", 125, 1.88, 9, 4, "d", "VIIIB"],
        [28, "Ni", "Nickel", 58.6934, "[Ar]3d8 4s2", 124, 1.91, 10, 4, "d", "VIIIB"],
        [29, "Cu", "Copper", 63.546, "[Ar]3d10 4s1", 132, 1.90, 11, 4, "d", "IB"],
        [30, "Zn", "Zinc", 65.38, "[Ar]3d10 4s2", 131, 1.65, 12, 4, "d", "IIB"],
        [31, "Ga", "Gallium", 69.723, "[Ar]3d10 4s2 4p1", 122, 1.81, 13, 4, "p", "IIIA"],
        [32, "Ge", "Germanium", 72.63, "[Ar]3d10 4s2 4p2", 122, 2.01, 14, 4, "p", "IVA"],
        [33, "As", "Arsenic", 74.921595, "[Ar]3d10 4s2 4p3", 119, 2.18, 15, 4, "p", "VA"],
        [34, "Se", "Selenium", 78.971, "[Ar]3d10 4s2 4p4", 116, 2.55, 16, 4, "p", "VIA"],
        [35, "Br", "Bromine", 79.904, "[Ar]3d10 4s2 4p5", 114, 2.96, 17, 4, "p", "VIIA"],
        [36, "Kr", "Krypton", 83.798, "[Ar]3d10 4s2 4p6", 116, 3.00, 18, 4, "p", "VIIIA"],
        [37, "Rb", "Rubidium", 85.4678, "[Kr]5s1", 211, 0.82, 1, 5, "s", "IA"],
        [38, "Sr", "Strontium", 87.62, "[Kr]5s2", 194, 0.95, 2, 5, "s", "IIA"],
        [39, "Y", "Yttrium", 88.90584, "[Kr]4d1 5s2", 180, 1.22, 3, 5, "d", "IIIB"],
        [40, "Zr", "Zirconium", 91.224, "[Kr]4d2 5s2", 160, 1.33, 4, 5, "d", "IVB"],
        [41, "Nb", "Niobium", 92.90637, "[Kr]4d4 5s1", 146, 1.60, 5, 5, "d", "VB"],
        [42, "Mo", "Molybdenum", 95.95, "[Kr]4d5 5s1", 139, 2.16, 6, 5, "d", "VIB"],
        [43, "Tc", "Technetium", 98, "[Kr]4d5 5s2", 136, 1.90, 7, 5, "d", "VIIB"],
        [44, "Ru", "Ruthenium", 101.07, "[Kr]4d7 5s1", 134, 2.20, 8, 5, "d", "VIIIB"],
        [45, "Rh", "Rhodium", 102.91, "[Kr]4d8 5s1", 134, 2.28, 9, 5, "d", "VIIIB"],
        [46, "Pd", "Palladium", 106.42, "[Kr]4d10", 137, 2.20, 10, 5, "d", "VIIIB"],
        [47, "Ag", "Silver", 107.87, "[Kr]4d10 5s1", 145, 1.93, 11, 5, "d", "IB"],
        [48, "Cd", "Cadmium", 112.41, "[Kr]4d10 5s2", 144, 1.69, 12, 5, "d", "IIB"],
        [49, "In", "Indium", 114.82, "[Kr]4d10 5s2 5p1", 167, 1.78, 13, 5, "p", "IIIA"],
        [50, "Sn", "Tin", 118.71, "[Kr]4d10 5s2 5p2", 140, 1.96, 14, 5, "p", "IVA"],
        [51, "Sb", "Antimony", 121.76, "[Kr]4d10 5s2 5p3", 133, 2.05, 15, 5, "p", "VA"],
        [52, "Te", "Tellurium", 127.60, "[Kr]4d10 5s2 5p4", 123, 2.10, 16, 5, "p", "VIA"],
        [53, "I", "Iodine", 126.90, "[Kr]4d10 5s2 5p5", 122, 2.66, 17, 5, "p", "VIIA"],
        [54, "Xe", "Xenon", 131.293, "[Kr]4d10 5s2 5p6", 108, 2.60, 18, 5, "p", "VIIIA"],
        [55, "Cs", "Cesium", 132.90545196, "[Xe]6s1", 232, 0.79, 1, 6, "s", "IA"],
        [56, "Ba", "Barium", 137.327, "[Xe]6s2", 196, 0.89, 2, 6, "s", "IIA"],
        [57, "La", "Lanthanum", 138.90547, "[Xe]5d1 6s2", 187, 1.10, 3, 6, "d", "IIIB"],
        [58, "Ce", "Cerium", 140.116, "[Xe]4f1 5d1 6s2", 182, 1.12, null, 6, "f", ""],
        [59, "Pr", "Praseodymium", 140.90766, "[Xe]4f3 6s2", 182, 1.13, null, 6, "f", ""],
        [60, "Nd", "Neodymium", 144.242, "[Xe]4f4 6s2", 182, 1.14, null, 6, "f", ""],
        [61, "Pm", "Promethium", 145, "[Xe]4f5 6s2", 182, 1.13, null, 6, "f", ""],
        [62, "Sm", "Samarium", 150.36, "[Xe]4f6 6s2", 180, 1.17, null, 6, "f", ""],
        [63, "Eu", "Europium", 151.964, "[Xe]4f7 6s2", 199, 1.20, null, 6, "f", ""],
        [64, "Gd", "Gadolinium", 157.25, "[Xe]4f7 5d1 6s2", 180, 1.20, null, 6, "f", ""],
        [65, "Tb", "Terbium", 158.92535, "[Xe]4f9 6s2", 177, 1.10, null, 6, "f", ""],
        [66, "Dy", "Dysprosium", 162.500, "[Xe]4f10 6s2", 178, 1.22, null, 6, "f", ""],
        [67, "Ho", "Holmium", 164.93033, "[Xe]4f11 6s2", 176, 1.23, null, 6, "f", ""],
        [68, "Er", "Erbium", 167.259, "[Xe]4f12 6s2", 175, 1.24, null, 6, "f", ""],
        [69, "Tm", "Thulium", 168.93422, "[Xe]4f13 6s2", 169, 1.25, null, 6, "f", ""],
        [70, "Yb", "Ytterbium", 173.054, "[Xe]4f14 6s2", 194, 1.10, 3, 6, "f", ""],
        [71, "Lu", "Lutetium", 174.9668, "[Xe]4f14 5d1 6s2", 160, 1.27, null, 6, "f", ""],
        [72, "Hf", "Hafnium", 178.49, "[Xe]4f14 5d2 6s2", 150, 1.30, 4, 6, "d", "IVB"],
        [73, "Ta", "Tantalum", 180.94788, "[Xe]4f14 5d3 6s2", 146, 1.50, 5, 6, "d", "VB"],
        [74, "W", "Tungsten", 183.84, "[Xe]4f14 5d4 6s2", 135, 2.36, 6, 6, "d", "VIB"],
        [75, "Re", "Rhenium", 186.207, "[Xe]4f14 5d5 6s2", 137, 1.90, 7, 6, "d", "VIIB"],
        [76, "Os", "Osmium", 190.23, "[Xe]4f14 5d6 6s2", 135, 2.20, 8, 6, "d", "VIIIB"],
        [77, "Ir", "Iridium", 192.217, "[Xe]4f14 5d7 6s2", 136, 2.20, 9, 6, "d", "VIIIB"],
        [78, "Pt", "Platinum", 195.084, "[Xe]4f14 5d9 6s1", 137, 2.28, 10, 6, "d", "VIIIB"],
        [79, "Au", "Gold", 196.966569, "[Xe]4f14 5d10 6s1", 144, 2.54, 11, 6, "d", "IB"],
        [80, "Hg", "Mercury", 200.592, "[Xe]4f14 5d10 6s2", 151, 2.00, 12, 6, "d", "IIB"],
        [81, "Tl", "Thallium", 204.38, "[Xe]4f14 5d10 6s2 6p1", 156, 1.62, 13, 6, "p", "IIIA"],
        [82, "Pb", "Lead", 207.2, "[Xe]4f14 5d10 6s2 6p2", 154, 2.33, 14, 6, "p", "IVA"],
        [83, "Bi", "Bismuth", 208.98040, "[Xe]4f14 5d10 6s2 6p3", 143, 2.02, 15, 6, "p", "VA"],
        [84, "Po", "Polonium", 209, "[Xe]4f14 5d10 6s2 6p4", 135, 2.0, 16, 6, "p", "VIA"],
        [85, "At", "Astatine", 210, "[Xe]4f14 5d10 6s2 6p5", 150, 2.2, 17, 6, "p", "VIIA"],
        [86, "Rn", "Radon", 222, "[Xe]4f14 5d10 6s2 6p6", 140, 0, 18, 6, "p", "VIIIA"],
        [87, "Fr", "Francium", 223, "[Rn]7s1", 348, 0.7, 1, 7, "s", "IA"],
        [88, "Ra", "Radium", 226, "[Rn]7s2", 283, 0.9, 2, 7, "s", "IIA"],
        [89, "Ac", "Actinium", 227, "[Rn]6d1 7s2", 215, 1.10, 3, 7, "d", "IIIB"],
        [90, "Th", "Thorium", 232.0377, "[Rn]6d2 7s2", 267, 1.3, null, 7, "f", ""],
        [91, "Pa", "Protactinium", 231.03588, "[Rn]5f2 6d1 7s2", 262, 1.5, null, 7, "f", ""],
        [92, "U", "Uranium", 238.02891, "[Rn]5f3 6d1 7s2", 268, 1.38, null, 7, "f", ""],
        [93, "Np", "Neptunium", 237, "[Rn]5f4 6d1 7s2", 275, 1.36, null, 7, "f", ""],
        [94, "Pu", "Plutonium", 244, "[Rn]5f6 7s2", 244, 1.28, null, 7, "f", ""],
        [95, "Am", "Americium", 243, "[Rn]5f7 7s2", 248, 1.30, null, 7, "f", ""],
        [96, "Cm", "Curium", 247, "[Rn]5f7 6d1 7s2", 247, 1.30, null, 7, "f", ""],
        [97, "Bk", "Berkelium", 247, "[Rn]5f9 7s2", 244, 1.30, null, 7, "f", ""],
        [98, "Cf", "Californium", 251, "[Rn]5f10 7s2", 243, 1.30, null, 7, "f", ""],
        [99, "Es", "Einsteinium", 252, "[Rn]5f11 7s2", 242, 1.30, null, 7, "f", ""],
        [100, "Fm", "Fermium", 257, "[Rn]5f12 7s2", 240, 1.30, null, 7, "f", ""],
        [101, "Md", "Mendelevium", 258, "[Rn]5f13 7s2", 238, 1.30, null, 7, "f", ""],
        [102, "No", "Nobelium", 259, "[Rn]5f14 7s2", 237, 1.30, 3, 7, "f", ""],
        [103, "Lr", "Lawrencium", 266, "[Rn]5f14 7s2 7p1", 243, 1.30, null, 7, "f", ""],
        [104, "Rf", "Rutherfordium", 267, "[Rn]5f14 6d2 7s2", 0, 0, 4, 7, "d", "IVB"],
        [105, "Db", "Dubnium", 268, "[Rn]5f14 6d3 7s2", 0, 0, 5, 7, "d", "VB"],
        [106, "Sg", "Seaborgium", 269, "[Rn]5f14 6d4 7s2", 0, 0, 6, 7, "d", "VIB"],
        [107, "Bh", "Bohrium", 270, "[Rn]5f14 6d5 7s2", 0, 0, 7, 7, "d", "VIIB"],
        [108, "Hs", "Hassium", 277, "[Rn]5f14 6d6 7s2", 0, 0, 8, 7, "d", "VIIIB"],
        [109, "Mt", "Meitnerium", 278, "[Rn]5f14 6d7 7s2", 0, 0, 9, 7, "d", "VIIIB"],
        [110, "Ds", "Darmstadtium", 281, "[Rn]5f14 6d8 7s2", 0, 0, 10, 7, "d", "VIIIB"],
        [111, "Rg", "Roentgenium", 282, "[Rn]5f14 6d9 7s2", 0, 0, 11, 7, "d", "IB"],
        [112, "Cn", "Copernicium", 285, "[Rn]5f14 6d10 7s2", 0, 0, 12, 7, "d", "IIB"],
        [113, "Nh", "Nihonium", 286, "[Rn]5f14 6d10 7s2 7p1", 0, 0, 13, 7, "p", "IIIA"],
        [114, "Fl", "Flerovium", 289, "[Rn]5f14 6d10 7s2 7p2", 0, 0, 14, 7, "p", "IVA"],
        [115, "Mc", "Moscovium", 290, "[Rn]5f14 6d10 7s2 7p3", 0, 0, 15, 7, "p", "VA"],
        [116, "Lv", "Livermorium", 293, "[Rn]5f14 6d10 7s2 7p4", 0, 0, 16, 7, "p", "VIA"],
        [117, "Ts", "Tennessine", 294, "[Rn]5f14 6d10 7s2 7p5", 0, 0, 17, 7, "p", "VIIA"],
        [118, "Og", "Oganesson", 294, "[Rn]5f14 6d10 7s2 7p6", 0, 0, 18, 7, "p", "VIIIA"]
      ];
  
      function reorderElements() {
        // Data for Lanthanides and Actinides is already in order—no reordering is required.
      }
      reorderElements();
  
      // STATE & TABLE SETTINGS
      let camX = 0, camY = 0, zoom = 1;
      let dragging = false, dragX, dragY, startCamX, startCamY;
      let highlightedRow = null, highlightedColGroup = null;
      let cellW, cellH, margin, yOffset, xOffset, starColW, rowStartOffset = 0;
      let showBlock = { s: true, p: true, d: true, f: true };
      let showElectronConfig = true;
      let showPrecious = false;
      let showMetal = false;
      let showNonMetal = false;
      let showNobleGas = false;
  
      // DRAG UTILS
      const clamp = (value, min, max) => Math.max(min, Math.min(value, max));
      const makeDraggable = (elem, options = {}) => {
        let isDragging = false, offsetX = 0, offsetY = 0;
        elem.addEventListener("mousedown", (e) => {
          if (e.button !== 0) return;
          if (options.check && !options.check(e)) return;
          isDragging = true;
          elem.classList.add("dragging");
          const rect = elem.getBoundingClientRect();
          offsetX = e.clientX - rect.left;
          offsetY = e.clientY - rect.top;
          e.preventDefault();
          e.stopPropagation();
        });
        document.addEventListener("mousemove", (e) => {
          if (!isDragging) return;
          const newX = clamp(e.clientX - offsetX, 0, window.innerWidth - elem.offsetWidth);
          const newY = clamp(e.clientY - offsetY, 0, window.innerHeight - elem.offsetHeight);
          elem.style.left = newX + "px";
          elem.style.top = newY + "px";
        });
        document.addEventListener("mouseup", () => {
          if (isDragging) { isDragging = false; elem.classList.remove("dragging"); }
        });
      };
  
      // Determine clickable areas for pointer cursor
      function checkCursor() {
        if (keyIsDown(17)) { cursor("default"); return; }
        let hovering = false;
        const mx = (mouseX - camX) / zoom;
        const my = (mouseY - (yOffset + camY)) / zoom;
        if (getHeaderColAt(mx, my) !== null) { hovering = true; }
        for (let p = 1; p <= 7; p++) {
          const px = xOffset - cellW * 0.6;
          const py = (p - 1) * cellH + rowStartOffset + cellH / 2;
          if (dist(mx, my, px, py) < cellW * 0.4) { hovering = true; break; }
        }
        for (let i = 0; i < elements.length; i++) {
          const ex = elements[i][11],
                ey = elements[i][12],
                ew = elements[i][13] || cellW;
          if (mx >= ex && mx < ex + ew && my >= ey && my < ey + cellH) { hovering = true; break; }
        }
        cursor(hovering ? "pointer" : "default");
      }
  
      // DOM EVENTS & INITIALIZATION
      document.addEventListener("DOMContentLoaded", () => {
        notePopup = document.getElementById("note-popup");
        infoPopup = document.getElementById("element-popup");
        document.getElementById("note-btn").onclick = () => {
          infoPopup.style.display = "none";
          selected = null;
          manualToggle = false;
          notePopup.style.display = "block";
          setDefaultNotePosition();
        };
        document.getElementById("showPrecious").onchange = (e) => { showPrecious = e.target.checked; };
        document.getElementById("showConfig").onchange = (e) => {
          showElectronConfig = e.target.checked;
          if (selected !== null) showInfoPopup(selected);
        };
        document.getElementById("showMetal").onchange = (e) => { showMetal = e.target.checked; };
        document.getElementById("showNonMetal").onchange = (e) => { showNonMetal = e.target.checked; };
        document.getElementById("showNobleGas").onchange = (e) => { showNobleGas = e.target.checked; };
        ["showS", "showP", "showD", "showF"].forEach(id => {
          const checkbox = document.getElementById(id);
          showBlock[id.replace("show", "").toLowerCase()] = !checkbox.checked;
          checkbox.onchange = (e) => { showBlock[id.replace("show", "").toLowerCase()] = !e.target.checked; };
        });
        notePopup.addEventListener("mousedown", (e) => { e.stopPropagation(); });
        notePopup.addEventListener("wheel", (e) => { e.stopPropagation(); });
        makeDraggable(notePopup, { check: (e) => !e.target.classList.contains("note-close") });
        makeDraggable(infoPopup);
        infoPopup.addEventListener("click", (e) => {
          if (!e.target.classList.contains("dragging")) {
            infoPopup.style.display = "none"; 
            selected = null; 
            manualToggle = false;
          }
        });
        document.getElementById("languageSelect").addEventListener("change", updateLanguage);
        updateLanguage();
      });
  
      function closeNotePopup(event) { event.stopPropagation(); notePopup.style.display = "none"; }
  
      function setDefaultElementPopupPosition(idx) {
        const popup = infoPopup;
        const popupRect = popup.getBoundingClientRect();
        const pw = popupRect.width, ph = popupRect.height;
        const elemCanvasX = elements[idx][11],
              elemCanvasY = elements[idx][12],
              elemCanvasW = elements[idx][13] || cellW,
              elemCanvasH = cellH;
        const screenX_center = (elemCanvasX + elemCanvasW / 2) * zoom + camX;
        const screenY_top = elemCanvasY * zoom + yOffset + camY;
        const screenY_bottom = (elemCanvasY + elemCanvasH) * zoom + yOffset + camY;
        const gap = 10;
        const toolbarRect = document.getElementById("toolbar").getBoundingClientRect();
        const toolbarBottom = toolbarRect.bottom || 0;
        let target_px, target_py;
        const py_above = screenY_top - ph - gap;
        if (py_above > toolbarBottom + gap) { target_py = py_above; target_px = screenX_center - pw / 2; }
        else { target_py = screenY_bottom + gap; target_px = screenX_center - pw / 2; }
        const final_px = Math.max(8, Math.min(window.innerWidth - pw - 8, target_px));
        const final_py = Math.max(toolbarBottom + gap, Math.min(window.innerHeight - ph - 8, target_py));
        popup.style.left = final_px + "px";
        popup.style.top = final_py + "px";
        popup.style.transformOrigin = "top left";
        popup.style.transform = `scale(${zoom})`;
      }
  
      function setDefaultNotePosition() {
        notePopup.style.left = "20px";
        notePopup.style.top = "80px";
        notePopup.style.transformOrigin = "top left";
        notePopup.style.transform = `scale(${zoom})`;
      }
  
      function setCellSize() {
        const windowWidth = window.innerWidth;
        const windowHeight = window.innerHeight;
        const isLandscape = windowWidth > windowHeight;
        // Adjust multiplier based on orientation for smartphone devices
        const multiplier = (windowWidth < 600) ? (isLandscape ? 0.7 : 0.9) : 1;
        cellW = Math.max(32, Math.floor(multiplier * (windowWidth - 56) / 19));
        cellH = Math.max(38, Math.floor(multiplier * (windowHeight - 110) / 10));
        starColW = cellW * 0.45;
        margin = Math.max(6, Math.min(cellW, cellH) * 0.16);
        if (windowWidth < 600) {
          if (isLandscape) {
            yOffset = 40; 
            rowStartOffset = cellH * 0.2;
            xOffset = Math.max(20, margin * 4);
          } else {
            yOffset = 60; 
            rowStartOffset = cellH * 0.25;
            // Increase xOffset in portrait so that columns 1 and 18 are not flush with the screen edge
            xOffset = Math.max(40, margin * 6);
          }
        } else {
          yOffset = 140; 
          rowStartOffset = cellH * 0.5;
          xOffset = Math.max(20, margin * 4);
        }
      }
  
      function computeColX() {
        const colX = [];
        let tmpX = xOffset;
        for (let g = 1; g <= 2; g++) { colX.push(tmpX); tmpX += cellW; }
        colX.push(tmpX); // original star column
        tmpX += starColW;
        for (let g = 3; g <= 18; g++) { colX.push(tmpX); tmpX += cellW; }
        let temp = colX[2];
        colX[2] = colX[3];
        colX[3] = temp;
        return colX;
      }
  
      function groupToDrawCol(group) { return group <= 2 ? group - 1 : group; }
  
      function fitTableToScreen() {
        const colCount = 19;
        const tableWidth = cellW * (colCount - 1) + starColW + 2 * xOffset;
        const tableHeight = 10 * cellH + fBlockYOffset + 60 + rowStartOffset;
        const availWidth = window.innerWidth, availHeight = window.innerHeight - yOffset - 12;
        const scaleX = availWidth / tableWidth, scaleY = availHeight / tableHeight;
        const factor = ((window.innerWidth < 600 && window.innerWidth > window.innerHeight) ? 1.1 : 1) * 1.10;
        zoom = Math.min(scaleX, scaleY, 1) * factor;
        camX = -(tableWidth * zoom - availWidth) / 2;
        camY = -(tableHeight * zoom - availHeight) / 2 + 10;
      }
  
      function drawExtraSymbols() {
        textAlign(CENTER, CENTER);
        // Reduce font size for extra symbols.
        textSize(cellH * 0.3);
      }
  
      function drawStars() {
        drawExtraSymbols();
      }
  
      function setup() {
        pixelDensity(window.devicePixelRatio);
        setCellSize();
        createCanvas(window.innerWidth, window.innerHeight);
        textFont("Arial");
        textAlign(CENTER, CENTER);
        fitTableToScreen();
      }
  
      function draw() {
        background(255);
        translate(camX, yOffset + camY);
        scale(zoom);
        drawTable();
        drawStars();
  
        // Compute center positions for rows 6 and 7.
        const centerYRow6 = (6 - 1) * cellH + rowStartOffset + cellH / 2;
        const centerYRow7 = (7 - 1) * cellH + rowStartOffset + cellH / 2;
  
        // "✬" between element 57 (La) and element 72 (Hf)
        let e57 = elements[56]; // La (original position and block remains "d")
        let e72 = elements[71]; // Hf
        let midX57_72 = (e57[11] + (e57[13] || cellW) + e72[11]) / 2;
        text("✬", midX57_72, centerYRow6);
  
        // "✬" before element 58 (Ce) – shift further left
        let e58 = elements[57];
        text("✬", e58[11] - 15, e58[12] + cellH / 2);
  
        // "✬✬" between element 89 (Ac) and element 104 (Rf)
        let e89 = elements[88]; // Ac (original position, block remains "d")
        let e104 = elements[103];
        let midX89_104 = (e89[11] + (e89[13] || cellW) + e104[11]) / 2;
        text("✬✬", midX89_104, centerYRow7);
  
        // "✬✬" before element 90 (Th) – shift further left
        let e90 = elements[89];
        text("✬✬", e90[11] - 15, e90[12] + cellH / 2);
  
        if (selected !== null && infoPopup.style.display !== "none") { 
          setDefaultElementPopupPosition(selected); 
        }
        if (notePopup.style.display !== "none") {
          notePopup.style.transformOrigin = "top left";
          notePopup.style.transform = `scale(${zoom})`;
        }
        checkCursor();
      }
  
      function windowResized() { 
        setCellSize(); 
        resizeCanvas(window.innerWidth, window.innerHeight); 
        fitTableToScreen(); 
      }
  
      function doubleClicked() {
        fitTableToScreen();
        selected = null;
        manualToggle = false;
        highlightedRow = null;
        highlightedColGroup = null;
        infoPopup.style.display = "none";
        return false;
      }
  
      function drawTable() {
        fill(60);
        textAlign(CENTER, CENTER);
        const colNumberFont = cellH * 0.35, rowNumberFont = cellH * 0.35;
        textSize(colNumberFont);
        const colX = computeColX();
  
        // Draw header highlight if a column is selected.
        if (highlightedColGroup !== null) {
          const idx = groupToDrawCol(highlightedColGroup);
          const highlightY = -cellH, highlightHeight = rowStartOffset + 7 * cellH - highlightY;
          fill("#ffe7b2");
          noStroke();
          rect(colX[idx], highlightY, cellW, highlightHeight, 0, 0, 8, 8);
          fill(60);
        }
  
        // Draw headers for groups 1 and 2.
        let tmpX = xOffset;
        for (let g = 1; g <= 2; g++) {
          text(g, tmpX + cellW / 2, -cellH * 0.7);
          tmpX += cellW;
        }
        tmpX += starColW;
  
        // Draw headers for groups 3 to 18.
        for (let g = 3; g <= 18; g++) {
          const idx = groupToDrawCol(g);
          text(g, colX[idx] + cellW / 2, -cellH * 0.7);
        }
  
        // Draw group labels.
        textSize(colNumberFont * 0.8);
        [1,2,13,14,15,16,17,18].forEach(g => {
          const idx = groupToDrawCol(g);
          const label = ({1:"IA",2:"IIA",13:"IIIA",14:"IVA",15:"VA",16:"VIA",17:"VIIA",18:"VIIIA"})[g] || "";
          text(label, colX[idx] + cellW / 2, -cellH * 0.18);
        });
        [3,4,5,6,7,8,9,10,11,12].forEach(g => {
          const idx = groupToDrawCol(g);
          const label = groupBLabels[g];
          text(label, colX[idx] + cellW / 2, -cellH * 0.18);
        });
        textSize(rowNumberFont);
        for (let p = 1; p <= 7; p++) {
          if (highlightedRow === p) {
            fill("#ffe7b2");
            noStroke();
            rect(xOffset - cellW * 1.25, (p - 1) * cellH + rowStartOffset, cellW * 19, cellH, 0, 0, 8, 8);
            fill(60);
          }
          text(p, xOffset - cellW * 0.60, (p - 1) * cellH + cellH / 2 + rowStartOffset);
        }
  
        let fIdx6 = 0, fIdx7 = 0;
        for (let i = 0; i < elements.length; i++) {
          let [Z, sym, name, mass, config, covRadius, electroNeg, group, period, block] = elements[i];
          let x, y, w;
          if (block === "f") {
            if (period === 6) {
              x = fIdx6 * cellW + colX[STAR_COL_IDX + 1];
              y = 7 * cellH + fBlockYOffset + rowStartOffset;
              w = cellW;
              fIdx6++;
            } else {
              x = fIdx7 * cellW + colX[STAR_COL_IDX + 1];
              y = 8 * cellH + fBlockYOffset + rowStartOffset;
              w = cellW;
              fIdx7++;
            }
          } else if (group !== null) {
            const colIdx = groupToDrawCol(group);
            x = colX[colIdx];
            y = (period - 1) * cellH + rowStartOffset;
            w = (colIdx === STAR_COL_IDX) ? starColW : cellW;
          } else continue;
          elements[i][11] = x;
          elements[i][12] = y;
          elements[i][13] = w;
          // Use effectiveBlock for coloring: for elements 57 (La) and 89 (Ac) use f-block colors
          let effectiveBlock = (Z === 57 || Z === 89) ? "f" : block;
  
          // Determine highlight condition.
          let colHighlight = highlightedColGroup !== null && group === highlightedColGroup && period >= 1 && period <= 7;
          // Do not highlight element 70 (Yb) and 102 (No) when highlighting column 3.
          if (highlightedColGroup === 3 && (Z === 70 || Z === 102)) {
            colHighlight = false;
          }
          const isHighlight = (highlightedRow !== null && period === highlightedRow) || colHighlight;
  
          let colVal = (selected === i) ? colorAlpha(blockHighlight[effectiveBlock], 255) : colorAlpha(blockColors[effectiveBlock], showBlock[effectiveBlock] ? 255 : 65);
          if (selected === i || hoveredIndex === i || isHighlight) {
            fill("#ffe7b2");
            stroke("#f55");
            strokeWeight(3);
          } else {
            if (!showBlock[effectiveBlock]) { colVal = lerpColor(colVal, color("#ffffff"), 0.9); }
            else {
              if (showMetal && isMetal(sym)) { colVal = lerpColor(colVal, color("#ffffff"), 0.9); }
              if (showNonMetal && isNonMetal(sym)) { colVal = lerpColor(colVal, color("#ffffff"), 0.9); }
              if (showPrecious && metalloids.has(sym)) { colVal = lerpColor(colVal, color("#ffffff"), 0.9); }
              if (showNobleGas && nobleGases.has(sym)) { colVal = lerpColor(colVal, color("#ffffff"), 0.9); }
            }
            fill(colVal);
            stroke("#888");
            strokeWeight(1);
          }
          rect(x, y, w - 2, cellH - 2, 10);
          fill(30, 30, 30);
          noStroke();
          textSize(cellH * 0.35);
          textAlign(CENTER, CENTER);
          text(sym, x + w / 2, y + cellH * 0.45);
          textSize(cellH * 0.15);
          textAlign(CENTER, CENTER);
          text(Z, x + w / 2 - (w * 0.35), y + cellH * 0.20);
          textSize(cellH * 0.13);
          textAlign(RIGHT, CENTER);
          // Round atomic mass to 4 decimal places
          text(Number(mass).toFixed(4), x + w - 6, y + cellH * 0.20);
          textSize(cellH * 0.13);
          textAlign(CENTER, CENTER);
          text(name, x + w / 2, y + cellH * 0.70);
          if (showElectronConfig) {
            textSize(cellH * 0.10);
            textAlign(CENTER, CENTER);
            text(formatElectronConfig(config), x + w / 2, y + cellH * 0.82);
          }
        }
  
        const bottomY = (8 * cellH + fBlockYOffset + rowStartOffset) + 90;
        const tableWidth = cellW * 18 + starColW + xOffset;
        let legendX = xOffset;
        textAlign(LEFT, CENTER);
        textSize(cellH * 0.34);
        function drawLegendItem(colorVal, labelText) {
          fill(colorVal);
          noStroke();
          rect(legendX, bottomY - (cellH * 0.34) * 0.5, cellH * 0.3, cellH * 0.3);
          legendX += cellH * 0.3 + 5;
          fill(0);
          text(labelText, legendX, bottomY);
          legendX += textWidth(labelText) + 15;
        }
        drawLegendItem(blockColors.s, translations[currentLang].legendS || translations[currentLang].showS);
        drawLegendItem(blockColors.p, translations[currentLang].legendP || translations[currentLang].showP);
        drawLegendItem(blockColors.d, translations[currentLang].legendD || translations[currentLang].showD);
        drawLegendItem(blockColors.f, translations[currentLang].legendF || translations[currentLang].showF);
        textAlign(RIGHT, CENTER);
        textSize(cellH * 0.34);
        fill(100);
        text("© HOÁ HỌC ABC", tableWidth - 10, bottomY);
      }
  
      // Detect header clicks
      function getHeaderColAt(mx, my) {
        if (my < -cellH || my > 0) return null;
        const colX = computeColX();
        for (let i = 0; i < colX.length; i++) {
          // Skip the star column
          if (i === STAR_COL_IDX) continue;
          const width = (i === STAR_COL_IDX) ? starColW : cellW;
          if (mx >= colX[i] && mx < colX[i] + width) {
            return i < STAR_COL_IDX ? i + 1 : i;
          }
        }
        return null;
      }
  
      function showInfoPopup(idx) {
        const popup = infoPopup;
        if (idx === null || idx < 0 || idx >= elements.length) { 
          popup.style.display = "none"; 
          return; 
        }
        const [Z, sym, name, mass, config, covalentRadius, electronegativity] = elements[idx];
        popup.innerHTML = `
          <div class="popup-title">${sym} - ${name}</div>
          <div>${translations[currentLang].atomicNumber || "Số hiệu nguyên tử"}: <b>${Z}</b></div>
          <div>${translations[currentLang].atomicMass || "Nguyên tử khối"}: ${Number(mass).toFixed(4)}</div>
          <div>${translations[currentLang].covalentRadius || "Bán kính cộng hóa trị"}: ${(!covalentRadius || covalentRadius==="N/A") ? "N/A" : covalentRadius + " pm"}</div>
          <div>${translations[currentLang].electronegativity || "Độ âm điện (Pauling)"}: ${(!electronegativity || electronegativity==="N/A") ? "N/A" : electronegativity}</div>
          ${showElectronConfig ? `<div>${translations[currentLang].electronConfig || "Cấu hình e"}: ${formatElectronConfig(config)}</div>` : ""}
        `;
        popup.style.display = "block";
        setDefaultElementPopupPosition(idx);
        requestAnimationFrame(() => setDefaultElementPopupPosition(idx));
      }
  
      function mousePressed(e) {
        const toolbarRect = document.getElementById("toolbar").getBoundingClientRect();
        const notePopupRect = notePopup.getBoundingClientRect();
        const clickedOnNotePopup =
          notePopup.style.display !== "none" &&
          mouseX >= notePopupRect.left &&
          mouseX <= notePopupRect.right &&
          mouseY >= notePopupRect.top &&
          mouseY <= notePopupRect.bottom;
        if (
          mouseY >= toolbarRect.top &&
          mouseY <= toolbarRect.bottom &&
          mouseX >= toolbarRect.left &&
          mouseX <= toolbarRect.right
        )
          return;
        if (!clickedOnNotePopup) { notePopup.style.display = "none"; }
        const mx = (mouseX - camX) / zoom;
        const my = (mouseY - yOffset - camY) / zoom;
        const isMac = navigator.platform.toUpperCase().indexOf("MAC") !== -1;
        if (mouseButton === LEFT && ((isMac && e.metaKey) || (!isMac && keyIsDown(17)))) {
          dragging = true;
          dragX = mouseX;
          dragY = mouseY;
          startCamX = camX;
          startCamY = camY;
          return;
        }
        const colGroup = getHeaderColAt(mx, my);
        if (colGroup !== null) {
          highlightedColGroup = (highlightedColGroup === colGroup) ? null : colGroup;
          highlightedRow = null;
          selected = null;
          showInfoPopup(null);
          manualToggle = false;
          return;
        }
        let rowHit = null;
        for (let p = 1; p <= 7; p++) {
          const centerX = xOffset - cellW * 0.6;
          const centerY = (p - 1) * cellH + rowStartOffset + cellH / 2;
          if (dist(mx, my, centerX, centerY) < cellW * 0.4) { rowHit = p; break; }
        }
        if (rowHit !== null) {
          highlightedRow = (highlightedRow === rowHit) ? null : rowHit;
          highlightedColGroup = null;
          selected = null;
          showInfoPopup(null);
          manualToggle = false;
          return;
        }
        let clickedElement = false;
        for (let i = 0; i < elements.length; i++) {
          const ex = elements[i][11],
                ey = elements[i][12],
                ew = elements[i][13] || cellW;
          if (mx >= ex && mx < ex + ew && my >= ey && my < ey + cellH) {
            if (selected === i) {
              selected = null;
              showInfoPopup(null);
              manualToggle = false;
            } else {
              selected = i;
              manualToggle = true;
              showInfoPopup(selected);
            }
            clickedElement = true;
            break;
          }
        }
        if (!clickedElement) {
          selected = null;
          highlightedRow = null;
          highlightedColGroup = null;
          manualToggle = false;
          showInfoPopup(null);
        }
        hoveredIndex = null;
      }
  
      function mouseDragged() {
        if (dragging) {
          camX = startCamX + (mouseX - dragX);
          camY = startCamY + (mouseY - dragY);
        }
      }
  
      function mouseReleased() { dragging = false; }
  
      function mouseWheel(e) {
        const notePopupRect = notePopup.getBoundingClientRect();
        const mouseOnNotePopup = (notePopup.style.display !== "none" &&
                                  mouseX >= notePopupRect.left && mouseX <= notePopupRect.right &&
                                  mouseY >= notePopupRect.top && mouseY <= notePopupRect.bottom);
        if (mouseOnNotePopup) return false;
        const scale0 = zoom;
        zoom *= (e.delta > 0) ? 0.85 : 1.15;
        zoom = Math.max(0.05, Math.min(10, zoom));
        const wx = (mouseX - camX) / scale0, wy = (mouseY - yOffset - camY) / scale0;
        camX -= (zoom - scale0) * wx;
        camY -= (zoom - scale0) * wy;
        if (selected !== null) { showInfoPopup(selected); }
        if (notePopup.style.display !== "none") {
          notePopup.style.transformOrigin = "top left";
          notePopup.style.transform = `scale(${zoom})`;
        }
        return false;
      }
  
      function colorAlpha(col, a = 255) {
        const c = color(col);
        c.setAlpha(a);
        return c;
      }
  
      function mouseMoved() {
        if (manualToggle) return;
        const mx = (mouseX - camX) / zoom;
        const my = (mouseY - yOffset - camY) / zoom;
        let newHoveredIndex = null;
        for (let i = 0; i < elements.length; i++) {
          const ex = elements[i][11],
                ey = elements[i][12],
                ew = elements[i][13] || cellW;
          if (mx >= ex && mx < ex + ew && my >= ey && my < ey + cellH) {
            newHoveredIndex = i;
            break;
          }
        }
        hoveredIndex = newHoveredIndex;
      }
  
      document.addEventListener("mousemove", mouseMoved);
    </script>
  </body>
</html>